"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TimeoutError = exports.addTimeout = void 0;
function addTimeout(promise, ms, createTimeoutError) {
    if (ms == 0)
        return promise;
    return new Promise((resolve, reject) => {
        let timer = setTimeout(() => {
            timer = null;
            let err = createTimeoutError ? createTimeoutError() : new TimeoutError(ms);
            reject(err);
        }, ms);
        promise.finally(() => {
            if (timer != null) {
                clearTimeout(timer);
            }
        }).then(resolve, reject);
    });
}
exports.addTimeout = addTimeout;
class TimeoutError extends Error {
    constructor(ms) {
        super(`timed out after ${ms} ms`);
    }
    get name() {
        return 'TimeoutError';
    }
}
exports.TimeoutError = TimeoutError;
//# sourceMappingURL=timeout.js.map